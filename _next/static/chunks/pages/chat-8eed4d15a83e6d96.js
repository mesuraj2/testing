(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{7722:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return s(7777)}])},7777:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return $}});var i,a,n=s(5893),r=s(7294),o=s(843),l=s(1163),d=s.n(l),c=s(8641),x=s(7741),h=s(9653),p=s(979),u=s(8830),m=s(7026),g=s(196),f=s(4221),j=s(1099);let y=()=>(0,n.jsxs)(c.Kq,{children:[(0,n.jsx)(j.Od,{height:"45px"}),(0,n.jsx)(j.Od,{height:"45px"}),(0,n.jsx)(j.Od,{height:"45px"}),(0,n.jsx)(j.Od,{height:"45px"}),(0,n.jsx)(j.Od,{height:"45px"}),(0,n.jsx)(j.Od,{height:"45px"}),(0,n.jsx)(j.Od,{height:"45px"}),(0,n.jsx)(j.Od,{height:"45px"}),(0,n.jsx)(j.Od,{height:"45px"}),(0,n.jsx)(j.Od,{height:"45px"}),(0,n.jsx)(j.Od,{height:"45px"}),(0,n.jsx)(j.Od,{height:"45px"})]});var k=s(5610),b=s(3382),_=s(3123);let C=e=>{let{children:t}=e,{isOpen:s,onOpen:i,onClose:a}=(0,h.qY)(),[o,l]=(0,r.useState)([]);return(0,r.useEffect)(()=>{_.Z.getItem("user")&&l(JSON.parse(_.Z.getItem("user")))},[]),(0,n.jsxs)(n.Fragment,{children:[t?(0,n.jsx)("span",{onClick:i,children:t}):(0,n.jsx)(x.hU,{d:{base:"flex"},icon:(0,n.jsx)(b.ON,{}),onClick:i}),(0,n.jsxs)(u.u_,{size:"lg",onClose:a,isOpen:s,isCentered:!0,children:[(0,n.jsx)(u.ZA,{}),(0,n.jsxs)(u.hz,{h:"410px",children:["suraj",(0,n.jsx)(u.ol,{}),(0,n.jsx)(u.mz,{children:(0,n.jsx)(x.zx,{onClick:a,children:"Close"})})]})]})]})};var w=s(3345);let E=e=>{let{user:t,handleFunction:s}=e;return(0,n.jsxs)(c.xu,{onClick:s,cursor:"pointer",bg:"#E8E8E8",_hover:{background:"#38B2AC",color:"white"},w:"100%",d:"flex",alignItems:"center",color:"black",px:3,py:2,mb:2,borderRadius:"lg",children:[(0,n.jsx)(w.qE,{mr:2,size:"sm",cursor:"pointer",name:t.name,src:t.pic}),(0,n.jsxs)(c.xu,{children:[(0,n.jsx)(c.xv,{children:t.name}),(0,n.jsxs)(c.xv,{fontSize:"xs",children:[(0,n.jsx)("b",{children:"Email : "}),t.email]})]})]})};var v=function(){let[e,t]=(0,r.useState)(""),[s,i]=(0,r.useState)([]),[a,l]=(0,r.useState)(!1),[d,g]=(0,r.useState)(!1),{setSelectedChat:j,user:b,notification:C,setNotification:w,chats:v,setChats:S}=(0,o.g)(),I=(0,f.pm)(),{isOpen:O,onOpen:F,onClose:N}=(0,h.qY)(),A=async()=>{if(!e){I({title:"Please Enter something in search",status:"warning",duration:5e3,isClosable:!0,position:"top-left"});return}try{l(!0);let t=await fetch("http://localhost:3001/api/auth/searchUser?search=".concat(e),{method:"GET",headers:{"auth-token":_.Z.getItem("token")}}),s=await t.json();l(!1),i(s)}catch(a){I({title:"Error Occured!",description:"Failed to Load the Search Results",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"})}},z=async e=>{try{g(!0);let t=await fetch("http://localhost:3001/api/chat",{method:"POST",headers:{"Content-Type":"application/json","auth-token":_.Z.getItem("token")},body:JSON.stringify({UserId:e})}),s=await t.json();v.find(e=>e._id===s._id)||S([s,...v]),j(s),g(!1),N()}catch(i){I({title:"Error fetching the chat",description:i.message,status:"error",duration:5e3,isClosable:!0,position:"bottom-left"})}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(c.xu,{d:"flex",className:"flex",justifyContent:"space-between",alignItems:"center",bg:"white",w:"100%",p:"5px 10px 5px 10px",borderWidth:"5px",children:[(0,n.jsx)(m.u,{label:"Search Users to chat",hasArrow:!0,placement:"bottom-end",children:(0,n.jsxs)(x.zx,{variant:"ghost",onClick:F,children:[(0,n.jsx)("i",{className:"fas fa-search"}),(0,n.jsx)(c.xv,{d:{base:"none",md:"flex"},px:4,children:"Search User"})]})}),(0,n.jsx)(c.xv,{fontSize:"2xl",fontFamily:"Work sans",children:"Pool & Save"})]}),(0,n.jsxs)(u.dy,{placement:"left",onClose:N,isOpen:O,children:[(0,n.jsx)(u.P1,{}),(0,n.jsxs)(u.sc,{children:[(0,n.jsx)(u.OX,{borderBottomWidth:"1px",children:"Search Users"}),(0,n.jsxs)(u.Ng,{children:[(0,n.jsxs)(c.xu,{d:"flex",pb:2,children:[(0,n.jsx)(p.II,{placeholder:"Search by name or email",mr:2,value:e,onChange:e=>t(e.target.value)}),(0,n.jsx)(x.zx,{onClick:A,children:"Go"})]}),a?(0,n.jsx)(y,{}):null==s?void 0:s.map(e=>(0,n.jsx)(E,{user:e,handleFunction:()=>z(e._id)},e._id)),d&&(0,n.jsx)(k.$,{ml:"auto",d:"flex"})]})]})]})]})};let S=(e,t,s,i)=>s<e.length-1&&e[s+1].sender._id===t.sender._id&&e[s].sender._id!==i?33:s<e.length-1&&e[s+1].sender._id!==t.sender._id&&e[s].sender._id!==i||s===e.length-1&&e[s].sender._id!==i?0:"auto",I=(e,t,s,i)=>s<e.length-1&&(e[s+1].sender._id!==t.sender._id||void 0===e[s+1].sender._id)&&e[s].sender._id!==i,O=(e,t,s)=>t===e.length-1&&e[e.length-1].sender._id!==s&&e[e.length-1].sender._id,F=(e,t,s)=>s>0&&e[s-1].sender._id===t.sender._id,N=(e,t)=>t[0]._id===e._id?t[1].name:t[0].name,A=(e,t)=>t[0]._id===e._id?t[1]:t[0];var z=s(3234);let T=e=>{let{user:t,handleFunction:s,admin:i}=e;return(0,n.jsxs)(c.Ct,{px:2,py:1,borderRadius:"lg",m:1,mb:2,variant:"solid",fontSize:12,colorScheme:"purple",cursor:"pointer",onClick:s,children:[t.name,i===t._id&&(0,n.jsx)("span",{children:" (Admin)"}),(0,n.jsx)(b.Tw,{pl:1})]})},Z=e=>{let{children:t}=e,{isOpen:s,onOpen:i,onClose:a}=(0,h.qY)(),[l,d]=(0,r.useState)(),[m,j]=(0,r.useState)([]),[y,k]=(0,r.useState)(""),[b,C]=(0,r.useState)([]),[w,v]=(0,r.useState)(!1),S=(0,f.pm)(),{user:I,chats:O,setChats:F}=(0,o.g)(),N=e=>{if(m.includes(e)){S({title:"User already added",status:"warning",duration:5e3,isClosable:!0,position:"top"});return}j([...m,e])},A=async e=>{if(k(e),e)try{v(!0);let t=await fetch("http://localhost:3001/api/auth/searchUser?search=".concat(y),{method:"GET",headers:{"auth-token":_.Z.getItem("token")}}),s=await t.json();console.log(s),v(!1),C(s)}catch(i){S({title:"Error Occured!",description:"Failed to Load the Search Results",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"})}},Z=e=>{j(m.filter(t=>t._id!==e._id))},D=async()=>{if(!l||!m){S({title:"Please fill all the feilds",status:"warning",duration:5e3,isClosable:!0,position:"top"});return}try{let e={headers:{"auth-token":_.Z.getItem("token")}},{data:t}=await g.ZP.post("http://localhost:3001/api/chat/group",{name:l,users:JSON.stringify(m.map(e=>e._id))},e);F([t,...O]),a(),S({title:"New Group Chat Created!",status:"success",duration:5e3,isClosable:!0,position:"bottom"})}catch(s){S({title:"Failed to Create the Chat!",description:s.response.data,status:"error",duration:5e3,isClosable:!0,position:"bottom"})}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{onClick:i,children:t}),(0,n.jsxs)(u.u_,{onClose:a,isOpen:s,isCentered:!0,children:[(0,n.jsx)(u.ZA,{}),(0,n.jsxs)(u.hz,{children:[(0,n.jsx)(u.xB,{fontSize:"35px",fontFamily:"Work sans",d:"flex",justifyContent:"center",children:"Create Group Chat"}),(0,n.jsx)(u.ol,{}),(0,n.jsxs)(u.fe,{d:"flex",flexDir:"column",alignItems:"center",children:[(0,n.jsx)(z.NI,{children:(0,n.jsx)(p.II,{placeholder:"Chat Name",mb:3,onChange:e=>d(e.target.value)})}),(0,n.jsx)(z.NI,{children:(0,n.jsx)(p.II,{placeholder:"Add Users eg: John, Piyush, Jane",mb:1,onChange:e=>A(e.target.value)})}),(0,n.jsx)(c.xu,{w:"100%",d:"flex",flexWrap:"wrap",children:m.map(e=>(0,n.jsx)(T,{user:e,handleFunction:()=>Z(e)},e._id))}),w?(0,n.jsx)("div",{children:"Loading..."}):null==b?void 0:b.slice(0,4).map(e=>(0,n.jsx)(E,{user:e,handleFunction:()=>N(e)},e._id))]}),(0,n.jsx)(u.mz,{children:(0,n.jsx)(x.zx,{onClick:D,colorScheme:"blue",children:"Create Chat"})})]})]})]})};function D(e){let{fetchAgain:t}=e,[s,i]=(0,r.useState)([]),{selectedChat:a,setSelectedChat:l,user:d,chats:h,setChats:p,Session:u}=(0,o.g)(),m=(0,f.pm)(),g=async()=>{try{let e=await fetch("http://localhost:3001/api/chat/fetchChat",{method:"GET",headers:{"auth-token":_.Z.getItem("token")}}),t=await e.json();p(t)}catch(s){m({title:"Error Occured!",description:"Failed to Load the chats",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"})}};return(0,r.useEffect)(()=>{i(JSON.parse(_.Z.getItem("user"))),_.Z.getItem("token")&&g()},[t]),(0,n.jsxs)(c.xu,{d:{base:a?"none":"flex",md:"flex"},flexDir:"column",alignItems:"center",p:3,bg:"white",w:{base:"100%",md:"31%"},borderRadius:"lg",borderWidth:"1px",children:[(0,n.jsxs)(c.xu,{pb:3,px:3,fontSize:{base:"28px",md:"30px"},fontFamily:"Work sans",d:"flex",w:"100%",justifyContent:"space-between",alignItems:"center",children:["My Chats",(0,n.jsx)(Z,{children:(0,n.jsx)(x.zx,{d:"flex",fontSize:{base:"17px",md:"10px",lg:"17px"},rightIcon:(0,n.jsx)(b.dt,{}),children:"New Group Chat"})})]}),(0,n.jsx)(c.xu,{d:"flex",flexDir:"column",p:3,bg:"#F8F8F8",w:"100%",h:"100%",borderRadius:"lg",overflowY:"scroll",children:h?(0,n.jsx)(c.Kq,{children:h&&h.map(e=>(0,n.jsxs)(c.xu,{onClick:()=>l(e),cursor:"pointer",bg:a===e?"#38B2AC":"#E8E8E8",color:a===e?"white":"black",px:3,py:2,borderRadius:"lg",children:[(0,n.jsx)(c.xv,{children:e.isGroupChat?e.chatName:N(s,e.users)}),e.latestMessage&&(0,n.jsxs)(c.xv,{fontSize:"xs",children:[(0,n.jsxs)("b",{children:[e.latestMessage.sender.name," : "]}),e.latestMessage.content.length>50?e.latestMessage.content.substring(0,51)+"...":e.latestMessage.content]})]},e._id))}):(0,n.jsx)(y,{})})]})}let B=e=>{let{messages:t}=e,{user:s}=(0,o.g)();return(0,n.jsx)("div",{children:t&&t.map((e,i)=>(0,n.jsxs)("div",{style:{display:"flex"},children:[(I(t,e,i,s._id)||O(t,i,s._id))&&(0,n.jsx)(m.u,{label:e.sender.name,placement:"bottom-start",hasArrow:!0,children:(0,n.jsx)(w.qE,{mt:"7px",mr:1,size:"sm",cursor:"pointer",name:e.sender.name,src:e.sender.pic})}),(0,n.jsx)("span",{style:{backgroundColor:"".concat(e.sender._id===s._id?"#BEE3F8":"#B9F5D0"),marginLeft:S(t,e,i,s._id),marginTop:F(t,e,i,s._id)?3:10,borderRadius:"20px",padding:"5px 15px",maxWidth:"75%"},children:e.content})]},e._id))})};JSON.parse('{"v":"5.5.2","fr":60,"ip":0,"op":104,"w":84,"h":40,"nm":"Typing-Indicator","ddd":0,"assets":[],"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"Oval 3","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.643],"y":[1]},"o":{"x":[1],"y":[0]},"t":18,"s":[35],"e":[100]},{"i":{"x":[0.099],"y":[1]},"o":{"x":[0.129],"y":[0]},"t":33,"s":[100],"e":[35]},{"i":{"x":[0.833],"y":[1]},"o":{"x":[0.167],"y":[0]},"t":65,"s":[35],"e":[35]},{"t":71}],"ix":11,"x":"var $bm_rt;\\n$bm_rt = loopOut(\'cycle\', 0);"},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[61,20,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.667,0.667,0.667],"y":[1,1,1]},"o":{"x":[1,1,0.333],"y":[0,0,0]},"t":18,"s":[100,100,100],"e":[140,140,100]},{"i":{"x":[0.032,0.032,0.667],"y":[1,1,1]},"o":{"x":[0.217,0.217,0.333],"y":[0,0,0]},"t":33,"s":[140,140,100],"e":[100,100,100]},{"i":{"x":[0.833,0.833,0.833],"y":[1,1,1]},"o":{"x":[0.167,0.167,0.167],"y":[0,0,0]},"t":65,"s":[100,100,100],"e":[100,100,100]},{"t":71}],"ix":6,"x":"var $bm_rt;\\n$bm_rt = loopOut(\'cycle\', 0);"}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":0,"k":[12,12],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse","hd":false},{"ty":"fl","c":{"a":0,"k":[0.847000002861,0.847000002861,0.847000002861,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Oval 3","np":2,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":3600,"st":0,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"Oval 2","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[1],"y":[0]},"t":9,"s":[35],"e":[98]},{"i":{"x":[0.023],"y":[1]},"o":{"x":[0.179],"y":[0]},"t":24,"s":[98],"e":[35]},{"i":{"x":[0.833],"y":[1]},"o":{"x":[0.167],"y":[0]},"t":56,"s":[35],"e":[35]},{"t":62}],"ix":11,"x":"var $bm_rt;\\n$bm_rt = loopOut(\'cycle\', 0);"},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[41,20,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.654,0.654,0.667],"y":[1,1,1]},"o":{"x":[1,1,0.333],"y":[0,0,0]},"t":9,"s":[100,100,100],"e":[140,140,100]},{"i":{"x":[0.11,0.11,0.667],"y":[1,1,1]},"o":{"x":[0.205,0.205,0.333],"y":[0,0,0]},"t":24,"s":[140,140,100],"e":[100,100,100]},{"i":{"x":[0.833,0.833,0.833],"y":[1,1,1]},"o":{"x":[0.167,0.167,0.167],"y":[0,0,0]},"t":56,"s":[100,100,100],"e":[100,100,100]},{"t":62}],"ix":6,"x":"var $bm_rt;\\n$bm_rt = loopOut(\'cycle\', 0);"}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":0,"k":[12,12],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse","hd":false},{"ty":"fl","c":{"a":0,"k":[0.847000002861,0.847000002861,0.847000002861,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Oval 2","np":2,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":3600,"st":0,"bm":0},{"ddd":0,"ind":3,"ty":4,"nm":"Oval 1","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[1],"y":[0]},"t":0,"s":[35],"e":[100]},{"i":{"x":[0.067],"y":[1]},"o":{"x":[0.125],"y":[0]},"t":15,"s":[100],"e":[35]},{"i":{"x":[0.833],"y":[1]},"o":{"x":[0.167],"y":[0]},"t":47,"s":[35],"e":[35]},{"t":53}],"ix":11,"x":"var $bm_rt;\\n$bm_rt = loopOut(\'cycle\', 0);"},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[21,20,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.673,0.673,0.667],"y":[1,1,1]},"o":{"x":[1,1,0.333],"y":[0,0,0]},"t":0,"s":[100,100,100],"e":[140,140,100]},{"i":{"x":[0.049,0.049,0.667],"y":[1,1,1]},"o":{"x":[0.198,0.198,0.333],"y":[0,0,0]},"t":15,"s":[140,140,100],"e":[100,100,100]},{"i":{"x":[0.833,0.833,0.833],"y":[1,1,1]},"o":{"x":[0.167,0.167,0.167],"y":[0,0,0]},"t":47,"s":[100,100,100],"e":[100,100,100]},{"t":53}],"ix":6,"x":"var $bm_rt;\\n$bm_rt = loopOut(\'cycle\', 0);"}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":0,"k":[12,12],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse","hd":false},{"ty":"fl","c":{"a":0,"k":[0.847000002861,0.847000002861,0.847000002861,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Oval 1","np":2,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":3600,"st":0,"bm":0},{"ddd":0,"ind":4,"ty":4,"nm":"BG","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[42,20,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0]],"v":[[-42,-20],[42,-20],[42,20],[-42,20]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"rd","nm":"Round Corners 1","r":{"a":0,"k":20,"ix":1},"ix":2,"mn":"ADBE Vector Filter - RC","hd":false},{"ty":"fl","c":{"a":0,"k":[0.96078401804,0.96078401804,0.96078401804,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"BG","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":3600,"st":0,"bm":0}],"markers":[]}');var G=s(9367);let P=e=>{let{fetchMessages:t,fetchAgain:s,setFetchAgain:i}=e,{isOpen:a,onOpen:l,onClose:d}=(0,h.qY)(),[m,g]=(0,r.useState)(),[j,y]=(0,r.useState)(""),[C,w]=(0,r.useState)([]),[v,S]=(0,r.useState)(!1),[I,O]=(0,r.useState)(!1),F=(0,f.pm)(),{selectedChat:N,setSelectedChat:A,user:Z}=(0,o.g)(),D=async e=>{if(y(e),e)try{S(!0);let t=await fetch("http://localhost:3001/api/auth/searchUser?search=".concat(j),{method:"GET",headers:{"auth-token":_.Z.getItem("token")}}),s=await t.json();S(!1),w(s)}catch(i){F({title:"Error Occured!",description:"Failed to Load the Search Results",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"}),S(!1)}},B=async()=>{if(m){try{O(!0);let e=await fetch("http://localhost:3001/api/chat/rename",{method:"PUT",headers:{"Content-Type":"application/json","auth-token":_.Z.getItem("token")},body:JSON.stringify({chatId:N._id,chatName:m})}),t=await e.json();console.log(t._id),A(t),i(!s),O(!1)}catch(a){F({title:"Error Occured!",description:a.response.data.message,status:"error",duration:5e3,isClosable:!0,position:"bottom"}),O(!1)}g("")}},G=async e=>{if(N.users.find(t=>t._id===e._id)){F({title:"User Already in group!",status:"error",duration:5e3,isClosable:!0,position:"bottom"});return}try{S(!0);let t=await fetch("http://localhost:3001/api/chat/groupadd",{method:"PUT",headers:{"Content-Type":"application/json","auth-token":_.Z.getItem("token")},body:JSON.stringify({chatId:N._id,userId:e._id})}),a=await t.json();A(a),i(!s),S(!1)}catch(n){F({title:"Error Occured!",status:"error",duration:5e3,isClosable:!0,position:"bottom"}),S(!1)}g("")},P=async e=>{try{let a=await fetch("http://localhost:3001/api/chat/groupremove",{method:"PUT",headers:{"Content-Type":"application/json","auth-token":_.Z.getItem("token")},body:JSON.stringify({chatId:N._id,userId:e._id})}),n=await a.json();e._id===Z._id?A():A(n),i(!s),t(),S(!1)}catch(r){F({title:"Error Occured!",description:r.response.data.message,status:"error",duration:5e3,isClosable:!0,position:"bottom"}),S(!1)}g("")};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x.hU,{d:{base:"flex"},icon:(0,n.jsx)(b.ON,{}),onClick:l}),(0,n.jsxs)(u.u_,{onClose:d,isOpen:a,isCentered:!0,children:[(0,n.jsx)(u.ZA,{}),(0,n.jsxs)(u.hz,{children:[(0,n.jsx)(u.xB,{fontSize:"35px",fontFamily:"Work sans",d:"flex",justifyContent:"center",children:N.chatName}),(0,n.jsx)(u.ol,{}),(0,n.jsxs)(u.fe,{d:"flex",flexDir:"column",alignItems:"center",children:[(0,n.jsx)(c.xu,{w:"100%",d:"flex",flexWrap:"wrap",pb:3,children:N.users.map(e=>(0,n.jsx)(T,{user:e,admin:N.groupAdmin,handleFunction:()=>P(e)},e._id))}),(0,n.jsxs)(z.NI,{d:"flex",children:[(0,n.jsx)(p.II,{placeholder:"Chat Name",mb:3,value:m,onChange:e=>g(e.target.value)}),(0,n.jsx)(x.zx,{variant:"solid",colorScheme:"teal",ml:1,isLoading:I,onClick:B,children:"Update"})]}),(0,n.jsx)(z.NI,{children:(0,n.jsx)(p.II,{placeholder:"Add User to group",mb:1,onChange:e=>D(e.target.value)})}),v?(0,n.jsx)(k.$,{size:"lg"}):null==C?void 0:C.map(e=>(0,n.jsx)(E,{user:e,handleFunction:()=>G(e)},e._id))]}),(0,n.jsx)(u.mz,{children:(0,n.jsx)(x.zx,{onClick:()=>P(Z),colorScheme:"red",children:"Leave Group"})})]})]})]})},U=e=>{let{fetchAgain:t,setFetchAgain:s}=e,[l,d]=(0,r.useState)([]),[h,u]=(0,r.useState)(!1),[m,j]=(0,r.useState)(""),[y,w]=(0,r.useState)(!1),[E,v]=(0,r.useState)(!1),[S,I]=(0,r.useState)(!1),O=(0,f.pm)(),F=(0,r.useRef)(null),T=()=>{var e;null===(e=F.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{T()},[l]);let{selectedChat:Z,setSelectedChat:D,user:U,notification:R,setNotification:$}=(0,o.g)(),V=async()=>{if(Z)try{let e={headers:{"auth-token":_.Z.getItem("token")}};u(!0);let{data:t}=await g.ZP.get("http://localhost:3001/api/message/allMessage/".concat(Z._id),e);d(t),u(!1),i.emit("join chat",Z._id)}catch(s){O({title:"Error Occured!",description:"Failed to Load the Messages",status:"error",duration:5e3,isClosable:!0,position:"bottom"})}};(0,r.useEffect)(()=>{(i=(0,G.ZP)("http://localhost:3001")).emit("setup",_.Z.getItem("id")),i.on("connected",()=>w(!0)),i.on("typing",()=>I(!0)),i.on("stop typing",()=>I(!1))},[]);let W=async e=>{if("Enter"===e.key&&m){i.emit("stop typing",Z._id);try{_.Z.getItem("token"),j(""),console.log(Z._id);let t=await fetch("http://localhost:3001/api/message",{method:"POST",headers:{"Content-Type":"application/json","auth-token":_.Z.getItem("token")},body:JSON.stringify({content:m,chatId:Z._id})}),s=await t.json();i.emit("new message",s),d([...l,s])}catch(a){O({title:"Error Occured!",description:"Failed to send the Message",status:"error",duration:5e3,isClosable:!0,position:"bottom"})}}};(0,r.useEffect)(()=>{V(),a=Z},[Z]),(0,r.useEffect)(()=>{i.on("message recieved",e=>{a&&a._id===e.chat._id?d([...l,e]):R.includes(e)||($([e,...R]),s(!t))})});let J=e=>{if(j(e.target.value),!y)return;E||(v(!0),i.emit("typing",Z._id));let t=new Date().getTime();setTimeout(()=>{new Date().getTime()-t>=3e3&&E&&(i.emit("stop typing",Z._id),v(!1))},3e3)};return(0,n.jsx)(n.Fragment,{children:Z?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(c.xv,{fontSize:{base:"28px",md:"30px"},pb:3,px:2,w:"100%",fontFamily:"Work sans",d:"flex",justifyContent:{base:"space-between"},alignItems:"center",children:[(0,n.jsx)(x.hU,{d:{base:"flex",md:"none"},icon:(0,n.jsx)(b.Rp,{}),onClick:()=>D("")}),l&&(Z.isGroupChat?(0,n.jsxs)(n.Fragment,{children:[Z.chatName.toUpperCase(),(0,n.jsx)(P,{fetchMessages:V,fetchAgain:t,setFetchAgain:s})]}):(0,n.jsxs)(n.Fragment,{children:[N(U,Z.users),(0,n.jsx)(C,{user:A(U,Z.users)})]}))]}),(0,n.jsxs)(c.xu,{d:"flex",flexDir:"column",justifyContent:"flex-end",p:3,bg:"#E8E8E8",w:"100%",h:"100%",borderRadius:"lg",overflowY:"scroll",children:[h?(0,n.jsx)(k.$,{size:"xl",w:20,h:20,alignSelf:"center",margin:"auto"}):(0,n.jsxs)("div",{className:"messages",children:[(0,n.jsx)(B,{messages:l}),(0,n.jsx)("div",{ref:F})]}),(0,n.jsxs)(z.NI,{onKeyDown:W,id:"first-name",isRequired:!0,mt:3,children:[S?(0,n.jsx)("div",{children:"Typing...."}):(0,n.jsx)(n.Fragment,{}),(0,n.jsx)(p.II,{variant:"filled",bg:"#E0E0E0",placeholder:"Enter a message..",value:m,onChange:J})]})]})]}):(0,n.jsx)(c.xu,{d:"flex",alignItems:"center",justifyContent:"center",h:"100%",children:(0,n.jsx)(c.xv,{fontSize:"3xl",pb:3,fontFamily:"Work sans",children:"Click on a user to start chatting"})})})},R=e=>{let{fetchAgain:t,setFetchAgain:s}=e,{selectedChat:i}=(0,o.g)();return(0,n.jsx)(c.xu,{d:{base:i?"flex":"none",md:"flex"},alignItems:"center",flexDir:"column",p:3,bg:"white",w:{base:"100%",md:"68%"},borderRadius:"lg",borderWidth:"1px",children:(0,n.jsx)(U,{fetchAgain:t,setFetchAgain:s})})};function $(){let[e,t]=(0,r.useState)(!1),{user:s}=(0,o.g)();return(0,r.useEffect)(()=>{_.Z.getItem("token")||d().push("/Login")},[]),(0,n.jsxs)("div",{style:{width:"100%"},children:[s&&(0,n.jsx)(v,{}),(0,n.jsxs)(c.xu,{className:"flex",justifyContent:"space-between",w:"100%",h:"91.5vh",p:"10px",children:[s&&(0,n.jsx)(D,{fetchAgain:e}),s&&(0,n.jsx)(R,{fetchAgain:e,setFetchAgain:t})]})]})}}},function(e){e.O(0,[345,539,774,888,179],function(){return e(e.s=7722)}),_N_E=e.O()}]);